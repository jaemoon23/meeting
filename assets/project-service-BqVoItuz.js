import{r as o,o as P,b as $,d as c,p as A,s as T,u as y,e as v,M as O,N as B,g as b,O as U,C as q}from"./permission-service-DHxnA_q4.js";const x="modulepreload",D=function(e){return"/meeting/"+e},S={},W=function(t,s,r){let n=Promise.resolve();if(s&&s.length>0){document.getElementsByTagName("link");const i=document.querySelector("meta[property=csp-nonce]"),l=(i==null?void 0:i.nonce)||(i==null?void 0:i.getAttribute("nonce"));n=Promise.allSettled(s.map(u=>{if(u=D(u),u in S)return;S[u]=!0;const h=u.endsWith(".css"),L=h?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${u}"]${L}`))return;const f=document.createElement("link");if(f.rel=h?"stylesheet":x,h||(f.as="script"),f.crossOrigin="",f.href=u,l&&f.setAttribute("nonce",l),document.head.appendChild(f),h)return new Promise((M,N)=>{f.addEventListener("load",M),f.addEventListener("error",()=>N(new Error(`Unable to preload CSS for ${u}`)))})}))}function a(i){const l=new Event("vite:preloadError",{cancelable:!0});if(l.payload=i,window.dispatchEvent(l),!l.defaultPrevented)throw i}return n.then(i=>{for(const l of i||[])l.status==="rejected"&&a(l.reason);return t().catch(a)})};let w=null,m=[],R=null,g=null,j=null,d=[],p=[],C=null,E=null;function z(e){R=e}function F(e){C=e}function G(e){E=e}function H(){const e=b();e&&(w=o(c,"projects"),P(w,t=>{const s=t.val();m=[],s&&(m=Object.entries(s).map(([r,n])=>({id:r,...n})).filter(r=>r.createdBy===e.uid?!0:r.members?r.members.some(n=>n.uid===e.uid||n.email===e.email):!1)),R&&R(m)}))}function J(){w&&(v(w),w=null),m=[]}function K(e){g=o(c,`milestones/${e}`),P(g,t=>{const s=t.val();d=[],s&&(d=Object.entries(s).map(([r,n])=>({id:r,...n})).sort((r,n)=>(r.order||0)-(n.order||0))),C&&C(d)}),j=o(c,`tasks/${e}`),P(j,t=>{const s=t.val();p=[],s&&(p=Object.entries(s).map(([r,n])=>({id:r,...n})).sort((r,n)=>{var a;return((a=r.startDate)==null?void 0:a.localeCompare(n.startDate))||0})),E&&E(p)})}function Q(){g&&(v(g),g=null),j&&(v(j),j=null),d=[],p=[]}async function X(e){const t=b();if(!t)return null;const s=o(c,"projects"),r=A(s),n={title:e.title,description:e.description||"",startDate:e.startDate,endDate:e.endDate,status:"active",members:[{uid:t.uid,email:t.email,name:t.displayName||t.email,role:"owner"}],createdBy:t.uid,createdByEmail:t.email,createdAt:Date.now()};return await T(r,n),U(n),r.key}async function Y(e,t){const s=o(c,`projects/${e}`);return await y(s,{...t,updatedAt:Date.now()}),!0}async function Z(e){return await $(o(c,`projects/${e}`)),await $(o(c,`milestones/${e}`)),await $(o(c,`tasks/${e}`)),!0}function I(){return m}function k(e){return m.find(t=>t.id===e)}async function ee(e,t){const s=o(c,`milestones/${e}`),r=A(s),n={title:t.title,startDate:t.startDate,endDate:t.endDate,color:t.color||"#238636",order:d.length,createdAt:Date.now()};return await T(r,n),r.key}async function te(e,t,s){const r=o(c,`milestones/${e}/${t}`);return await y(r,{...s,updatedAt:Date.now()}),!0}function ne(){return d}async function se(e,t){const s=b();if(!s)return null;const r=o(c,`tasks/${e}`),n=A(r),a={title:t.title,milestoneId:t.milestoneId||null,assignee:t.assignee||null,startDate:t.startDate,endDate:t.endDate,status:"pending",priority:t.priority||"medium",createdBy:s.uid,createdAt:Date.now()};if(await T(n,a),a.assignee){const i=k(e);i&&B(i,a,a.assignee)}return n.key}async function re(e,t,s){const r=b(),n=_(t),a=k(e),i=o(c,`tasks/${e}/${t}`);return await y(i,{...s,updatedAt:Date.now()}),a&&s.status==="completed"&&(n==null?void 0:n.status)!=="completed"&&O(a,{...n,...s},(r==null?void 0:r.displayName)||(r==null?void 0:r.email)||"알 수 없음"),a&&s.assignee&&(!(n!=null&&n.assignee)||n.assignee.email!==s.assignee.email)&&B(a,{...n,...s},s.assignee),!0}async function ie(e,t){return await $(o(c,`tasks/${e}/${t}`)),!0}function ae(){return p}function _(e){return p.find(t=>t.id===e)}async function oe(e,t){const s=k(e);if(!s)return!1;const r=s.members||[];return r.some(n=>n.email===t.email)?!1:(r.push({uid:t.uid||null,email:t.email,name:t.name||t.email,role:t.role||"member"}),await y(o(c,`projects/${e}`),{members:r}),!0)}async function ce(e,t){const s=k(e);if(!s)return!1;const r=(s.members||[]).filter(n=>n.email!==t);return await y(o(c,`projects/${e}`),{members:r}),!0}async function le(e,t,s){const r=k(e);if(!r)return!1;const n=r.members||[],a=n.findIndex(i=>i.email===t);return a===-1?!1:(n[a].role=s,await y(o(c,`projects/${e}`),{members:n}),!0)}async function ue(){const e=b();if(!e)return[];const t=[];for(const s of m){const n=(await q(o(c,`tasks/${s.id}`))).val();n&&Object.entries(n).forEach(([a,i])=>{var l,u;(((l=i.assignee)==null?void 0:l.email)===e.email||((u=i.assignee)==null?void 0:u.uid)===e.uid)&&t.push({id:a,...i,projectId:s.id,projectTitle:s.title})})}return t.sort((s,r)=>{var n;return((n=s.endDate)==null?void 0:n.localeCompare(r.endDate))||0})}export{W as _,ae as a,ne as b,z as c,F as d,G as e,H as f,k as g,ue as h,Z as i,X as j,ee as k,se as l,oe as m,Q as n,ie as o,le as p,ce as q,J as r,K as s,I as t,re as u,Y as v,te as w};
